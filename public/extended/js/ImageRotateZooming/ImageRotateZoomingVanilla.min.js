!function(){function t(t){switch(degree_select=t,cw=img.naturalWidth,ch=img.naturalHeight,cx=0,cy=0,t){case 0:canvas.setAttribute("width",img.naturalWidth),canvas.setAttribute("height",img.naturalHeight),cContext.rotate(t*Math.PI/180),cContext.translate(translatePos.x,translatePos.y),cContext.scale(scale,scale),cContext.drawImage(img,cx,cy,cw,ch);break;case 90:cy=-1*img.naturalHeight,cw=img.naturalHeight,ch=img.naturalWidth,canvas.setAttribute("width",img.naturalHeight),canvas.setAttribute("height",img.naturalWidth),cContext.translate(translatePos.x,translatePos.y),cContext.rotate(t*Math.PI/180),cContext.scale(scale,scale),cContext.drawImage(img,cx,cy,ch,cw);break;case 180:cx=-1*img.naturalWidth,cy=-1*img.naturalHeight,cw=img.naturalHeight,ch=img.naturalWidth,canvas.setAttribute("width",img.naturalWidth),canvas.setAttribute("height",img.naturalHeight),cContext.translate(translatePos.x,translatePos.y),cContext.scale(scale,scale),cContext.rotate(t*Math.PI/180),cContext.drawImage(img,cx,cy,ch,cw);break;case 270:cx=-1*img.naturalWidth,cw=img.naturalHeight,ch=img.naturalWidth,canvas.setAttribute("width",img.naturalHeight),canvas.setAttribute("height",img.naturalWidth),cContext.translate(translatePos.x,translatePos.y),cContext.rotate(t*Math.PI/180),cContext.scale(scale,scale),cContext.drawImage(img,cx,cy,ch,cw)}}window.ImageRotateZooming=function e(a,i){var n;if(NodeList.prototype.isPrototypeOf(a)||(a=Array(a)),!((n=document.createElement("canvas")).getContext&&n.getContext("2d"))){alert('Your browser doesn\'t support "canvas"');return}(i=Object.assign({zoom:!0,rotate:!0},i)).zoom&&document.body.addEventListener("mousewheel",function(t){"canvas"===t.target.id&&(t.preventDefault(),t.stopPropagation())}),a.forEach(function(e){(canvas=document.createElement("canvas")).id="canvas",canvas.width=300,canvas.height=300,e.parentNode.insertBefore(canvas,e.nextSibling),(img=new Image).src=e.src,img.naturalWidth=e.width,img.naturalHeight=e.height,rotate=0,cContext=canvas.getContext("2d"),cw=img.naturalWidth,ch=img.naturalHeight,cx=0,cy=0,degree_select=0,startDragOffset={},translatePos={x:0,y:0},scale=1;var a=!1;canvas.setAttribute("width",cw),canvas.setAttribute("height",ch),img.onload=function(){cContext.drawImage(img,cx,cy,cw,ch)},e.style.display="none";var n=document.createElement("div");n.id="rotate_container",e.parentNode.insertBefore(n,e.nextSibling),i.rotate&&[0,90,180,270].forEach(function(e){var a=document.createElement("span");a.className="degree",a.innerHTML="<a>"+e+"\xb0</a>",a.href="javascript:;",n.appendChild(a),a.dataset.degree=e,a.addEventListener("click",function(){t(parseInt(this.dataset.degree))})}),canvas.addEventListener("mousedown",function(t){a=!0,startDragOffset.x=t.clientX-translatePos.x,startDragOffset.y=t.clientY-translatePos.y}),canvas.addEventListener("mouseup",function(){a=!1}),canvas.addEventListener("mouseover",function(){a=!1}),canvas.addEventListener("mouseout",function(){a=!1}),canvas.addEventListener("mousemove",function(e){if(a){if(0===degree_select||180===degree_select)var i,n=img.naturalHeight*scale-canvas.height,r=img.naturalWidth*scale-canvas.width;else var n=img.naturalWidth*scale-canvas.height,r=img.naturalHeight*scale-canvas.width;translatePos.y,translatePos.x=e.clientX-startDragOffset.x,translatePos.y=e.clientY-startDragOffset.y,translatePos.y<=-n&&(translatePos.y=-n),translatePos.y>0&&(translatePos.y=0),translatePos.x<=-r&&(translatePos.x=-r),translatePos.x>0&&(translatePos.x=0),translatePos,t(degree_select)}}),canvas.addEventListener("mousewheel",function(e){i.zoom&&(function t(e,a){if(0===degree_select||180===degree_select)var i=canvas.height;else var i=canvas.width;if("more"===e||"less"===e&&img.naturalHeight*scale>i){if("more"===e?scale+=.1:scale-=.1,0===degree_select||180===degree_select)var n=img.naturalWidth*scale+a.x-canvas.width,r=img.naturalHeight*scale+a.y-canvas.height;else var n=img.naturalHeight*scale+a.x-canvas.width,r=img.naturalWidth*scale+a.y-canvas.height;n<0&&(a.x=a.x-n),r<0&&(a.y=a.y-r),canvas.setAttribute("width",img.naturalHeight),canvas.setAttribute("height",img.naturalWidth),cContext.translate(a.x,a.y),cContext.scale(scale,scale)}cContext.drawImage(img,cx,cy,cw,ch)}(e.wheelDelta>0?"more":"less",translatePos),t(degree_select),e.preventDefault())})})}}();