{% import "index/macro/macro_index.html.twig" as macro_index %}

{{ macro_index.tinymce_init_js() }}
{{ macro_index.tinymce_js(commentType.vars.name~'_messageComment') }}

<div id="comment_refresh">
	{% form_theme commentType 'index/CSS/form_div_layout.html.twig' %}
	{{ form_start(commentType, {'action': path('APCommentBundle_create', { 'idClassName' : idClassName, 'className': className }), 'attr':{'class' : 'form-horizontal', 'id': commentType.vars.id, novalidate: 'novalidate'}}) }}
		{% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}
			{{ "comment.edit.LoggedAs"|trans([], "validators") }}<strong>{{ app.user.username }}</strong>
		{% endif %}
		<div class="form-table form-table-4cols form-table-collapse">
			{% if is_granted("IS_AUTHENTICATED_REMEMBERED") == false %}
			<div class="form-table-cell form-table-cell-head">{{ form_label(commentType.anonymousAuthorComment, "comment.edit.Pseudo"|trans([], "validators")) }}</div>
			<div class="form-table-cell">{{ form_errors(commentType.anonymousAuthorComment) }}{{ form_widget(commentType.anonymousAuthorComment, {'attr':{'class':'form-control'}}) }}</div>

			<div class="form-table-cell form-table-cell-head">{{ form_label(commentType.emailComment, "comment.edit.MailDisplay"|trans([], "validators")) }}</div>
			<div class="form-table-cell">{{ form_errors(commentType.emailComment) }}{{ form_widget(commentType.emailComment, {'attr':{'class': 'form-control'}}) }}</div>
			{% endif %}
			<div class="form-table-cell form-table-cell-head">{{ form_label(commentType.messageComment, "comment.edit.Comment"|trans([], "validators")) }}</div>
			<div class="form-table-cell">{{ form_errors(commentType.messageComment) }}{{ form_widget(commentType.messageComment) }}</div>
		</div>
		<div class="mt-3 text-right">
			<button class="submitcomment btn" type="submit">{{ "comment.edit.Validate"|trans([], "validators") }}</button>
		</div>
		<hr class="hr2" />
		{{ form_rest(commentType) }}
		{{ form_errors(commentType) }}
	{{ form_end(commentType) }}

	<div id="list_messages">
		{% include 'comment/Comment/list.html.twig' %}
	</div>
	
	<script>
		$("#{{ commentType.vars.id }}").submit(function(event)
		{
			var DATA = $('#{{ commentType.vars.id }}').serialize();

			$.ajax(
			{
				type: "POST",
				url: "{{ path('APCommentBundle_create', { 'idClassName' : idClassName, 'className': className }) }}",
				data: DATA,
				cache: false,
				success: function(data)
				{
					$('#comment_refresh').html(data);
				}
			});
			event.preventDefault();
		});
	</script>
</div>